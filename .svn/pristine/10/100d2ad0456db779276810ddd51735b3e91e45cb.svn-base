package kr.or.ddit.classroom.controller;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import kr.or.ddit.classroom.service.DiaryService;
import kr.or.ddit.util.ArticlePage;
import kr.or.ddit.vo.ClasVO;
import kr.or.ddit.vo.DiarySearchVO;
import kr.or.ddit.vo.MemberVO;
import kr.or.ddit.vo.NttVO;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@RequestMapping("/diary")
@Controller
public class DiaryController {
	
	@Autowired
	DiaryService diaryService;
	
	/** 일기장 목록으로 이동하는 메서드 */
	@GetMapping("/goToDiaryList")
	public String goToDiaryList(HttpServletRequest request, Model model) {
		MemberVO mberVO = (MemberVO) request.getSession().getAttribute("USER_INFO");
		log.debug("goToDiaryList mberVO => " + mberVO);
		
		model.addAttribute("mberVO", mberVO);
		return "class/diaryList";
	}
	
	/** 일기장 쓰기 */
	@GetMapping("/addDiary")
	public String addDiary(HttpServletRequest request, Model model) {
		MemberVO mberVO = (MemberVO) request.getSession().getAttribute("USER_INFO");
		log.debug("addDiary mberVO => " + mberVO);
		
		model.addAttribute("mberVO", mberVO);
		
		return "class/diaryAdd";
	}
	
	/** 일기장  쓰기에서 날씨를 불러오기위해 학교가 소속된 지역을 가져오는 메서드 */
	@ResponseBody
	@GetMapping("/getSchulArea")
	public String getSchulArea(HttpServletRequest request) {
		ClasVO clasVO = (ClasVO) request.getSession().getAttribute("CLASS_INFO");
		log.debug("getSchulArea clasVO => " + clasVO);
		
		String area = this.diaryService.getSchulArea(clasVO.getSchulCode());
		return area;
	}
	
	/** 일기장 등록 */
	@ResponseBody
	@PostMapping("/addDiaryAct")
	public int addDiaryAct(HttpServletRequest request, NttVO nttVO) {
		int result = this.diaryService.addDiaryAct(request, nttVO);
		
		log.debug("addDiaryAct nttVO => " + nttVO);
		log.debug("addDiaryAct result => " + result);
		
		return result;
	}
	
	/** 일기장 목록 불러오기 */
	@ResponseBody
	@PostMapping("/getDiaryList")
	public ArticlePage<NttVO> getDiaryList(DiarySearchVO diarySearchVO) {
		ArticlePage<NttVO> nttVOPage = this.diaryService.getDiaryList(diarySearchVO);
		
		log.debug("getDiaryList diarySearchVO => " + diarySearchVO);
		log.debug("getDiaryList nttVOPage => " + nttVOPage);
		
		return nttVOPage;
	}
}
