<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<script type="text/javascript" src="/resources/js/jquery.min.js"></script>
<script>
//전역 변수
var currentPage = "${param.currentPage}";
var keyword = "";
var schulCode = "${param.schulCode}";

//검색
function fn_search(page) {
    var keyword = $("#keyword").val();
    
    var data = {
        "schulCode": schulCode,
        "currentPage": page, // page 매개변수 사용
        "keyword": keyword
    }

    console.log("data:", data);

    $.ajax({
        url: "/school/dataRoomAjax",
        type: "post",
        data: JSON.stringify(data),
        contentType: "application/json;charset=utf-8",
        dataType: "json",
        beforeSend: function(xhr) {
            xhr.setRequestHeader("${_csrf.headerName}", "${_csrf.token}");
        },
        success: function(result) {
            console.log("result.pagingArea", result.pagingArea);

            if (result.total == 0) {
                $("#keyword").val('');

                var str = "<tr>";
                str += "<td colspan='7' style='text-align: center;font-size: 2.0rem;'>" + keyword + "에 대한 검색 결과가 없습니다</td>";
                str += "</tr>";
                
                $("#dataBody").html(str);
            } else {
                var str = ""; // 결과를 누적하기 위해 빈 문자열로 초기화

                $.each(result.content, function(idx, nttVO) {
					console.log("nttVO[" + idx + "] : ", nttVO);
					str += "<tr onclick=\"location.href='/school/dataRoomDetail?schulCode=" +nttVO.schulCode+ "&nttCode=" + nttVO.nttCode + "'\" style=\"cursor: pointer;\">";
					str += "<td>" + nttVO.rnum + "</td>";
					str += "<td>" + nttVO.nttNm + "</td>";
					str += "<td>" + nttVO.mberNm + "</td>";
					str += "<td>" + nttVO.nttWritngDt + "</td>";
					str += "<td>" + nttVO.nttRdcnt + "</td>";
					str += "</tr>";

				});


                $("#dataBody").html(str);
            }

            $("#divPaging").html(result.pagingArea);
        },
        error: function(xhr, status, error) {
            console.error(status, error);
        }
    });
}


$(function(){
		fn_search(1);
		
		//input태그에서 엔터시 검색버튼누르기
		var input = $("#keyword");

		  input.on("keypress", function(event) {
		      if (event.key === "Enter") {
		          event.preventDefault();
		          $("#btnSearch").click();
		      }
		  });

		currentPage = "1";
		// 자료실 검색
		$("#btnSearch").on("click",function(){
			fn_search(1);
		});
		
		//등록버튼
		$("#createBtn").on("click", function() {
			location.href = "/school/dataRoomCreate?schulCode="+schulCode; //GET방식
		});
		
	})
	
	
	
</script>
<style>
.pagination {
    display: flex;
    padding-left: 0;
    margin: 20px 0;
    border-radius: 4px;
}
h3{
	font-size: 2.2rem;
	text-align: center;
	margin-top: 60px;
	backdrop-filter: blur(4px);
	background-color: rgba(255, 255, 255, 1);
	border-radius: 50px;
	box-shadow: 35px 35px 68px 0px rgba(145, 192, 255, 0.5), inset -8px -8px 16px 0px rgba(145, 192, 255, 0.6), inset 0px 11px 28px 0px rgb(255, 255, 255);
	width: 370px;
	padding-top: 35px;
	padding-bottom: 35px;
	margin: auto;
	margin-top: 50px;
	margin-bottom: 40px;
}
</style>
<div class="sparkline8-list">
	<div class="sparkline8-hd">
		<div class="main-sparkline8-hd">
			<h3>
				<img src="/resources/images/school/dataRoom1.png" style="width:50px; display:inline-block; vertical-align:middel;">
					자료실 목록
				<img src="/resources/images/school/dataRoom2.png" style="width:50px; display:inline-block; vertical-align:middel;">		
			</h3>
			
		</div>
	</div>
	<div class="row">
	
		<!-- 등록 버튼 시작 -->
		<div class="col-md-10 text-right">
			<!-- text-right를 사용하여 오른쪽 정렬 -->
			<button type="button" id="createBtn" class="btn btn-custon-rounded-two btn-primary">등록</button>
		</div>
		<!-- 등록 버튼 끝 -->
		<!-- 검색 -->
		<div class="col-md-2 text-right">
			<!-- text-right를 사용하여 오른쪽 정렬 -->
			<div class="breadcome-heading">
				<form role="search" class="sr-input-func">
					<input type="text" name="keyword" id="keyword" placeholder="Search..."
						class="search-int form-control"> <a href="#" id="btnSearch"><i
						class="fa fa-search"></i></a>
				</form>
			</div>
		</div>
		<!-- 검색 끝 -->
	</div>



	<div class="sparkline8-graph">
		<div class="static-table-list">
			<table class="table">
				<thead>
					<tr>
						<th>순번</th>
						<th>제목</th>
						<th>작성자</th>
						<th>등록일</th>
						<th>조회수</th>
					</tr>
				</thead>
				<tbody id="dataBody">
					<%-- <c:forEach var="nttVO" items="${nttVOList}" varStatus="stat">
						<tr onclick="location.href='/school/dataRoomDetail?nttCode=${nttVO.nttCode}'"
							style="cursor: pointer;">
							<td>${nttVO.rnum}</td>
							<td>${nttVO.nttNm}</td>
							<td>${nttVO.mberNm}</td>
							<td><fmt:formatDate value="${nttVO.nttWritngDt}"
									pattern="yyyy-MM-dd" /></td>
						</tr>
					</c:forEach> --%>
				</tbody>
			</table>
		</div>
	</div>
	<div class="pull-right pagination" id="divPaging"></div>
</div>