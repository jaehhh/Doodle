<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<style>
.add-product {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.taskBtn {
    text-align: right;
}

.taskBtn button {
    margin: 10px;
}
</style>
<script type="text/javascript" src="/resources/js/commonFunction.js"></script>
<script type="text/javascript" src="/resources/js/jquery.min.js" ></script>
<script type="text/javascript">
// 전역 변수
var currentPage = "${param.currentPage}";
var keyword = "";
var clasCode = "${clasCode}";

function fn_search(currentPage) {
	var keyword = $("#keyword").val();
    
//     if(currentPage == "") currentPage = "1";
    
    var data = {
		"keyword": keyword,
		"currentPage": currentPage,
		"clasCode": clasCode
    };
    
    // 과제 리스트 불러오기
    $.ajax({
		url:"/task/taskListAjax",
		contentType:"application/json;charset=utf-8",
		data:JSON.stringify(data),
		type:"post",
		dataType:"json",
		beforeSend:function(xhr){
			xhr.setRequestHeader("${_csrf.headerName}","${_csrf.token}");
		},
		success: function(res){
	        var str = "";
	        var total = res.total;
	        var currentPage = res.currentPage;
			console.log("res", res);
          
		$.each(res.content, function(idx, taskVO){
	        var taskCode = taskVO.taskCode;
	        str += "<tr>";
	        str += "<td>" + (total - ((currentPage - 1) * 10 + idx)) + "</td>";
	        str += "<td>"
	        if(prevToday(dateFormat(taskVO.taskEndDt))){
	        	str += "<진행 중>";
	        }else{
	        	str += "<마감>";
	        }
	        str += "</td>";
	        str += "<td><a href='/task/taskDetail?taskCode=" + taskCode + "&clasCode=" + clasCode + "'>"+taskVO.taskSj + "</a></td>";
	        str += "<td>" + dateFormat(taskVO.taskBeginDt) + "</td>";
	        str += "<td>" + dateFormat(taskVO.taskEndDt) + "</td>";
	        str += "<td>" + taskVO.hrtchrVOList[0].memberVOList[0].mberNm + "</td>";
	        str += "<td>" + taskVO.taskCnt + "</td>";
	        str += "<td>";
             
            if(taskVO.atchFileCode == null){
               str += "";
            }else{
               str += "<i class='fa fa-paperclip'></i>";
            }
            
            str += "</td>";
            str += "</tr>";
		});
	        
	        $('#taskBody').html(str);
	        $("#divPaging").html(res.pagingArea);
		}
	});
}

$(function(){
   // 과제 리스트 불러오기
   fn_search(1);
   
    // 과제 게시판 검색
   $("#search").on("click", function(){
      fn_search(1);
   });
    
    // 과제 등록하기
   $("#taskInsertBtn").on("click", function(){
      location.href = "/task/taskInsertForm?clasCode=" + clasCode;
   });
});
</script>
<hr>
<div class="row">
   <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
      <div class="breadcome-list single-page-breadcome">
         <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
               <div class="breadcome-heading">
               <!-- 검색 바 -->
                  <form role="search" class="sr-input-func">
                     <input type="text" id="keyword" name="keyword"
                        class="search-int form-control">
                        <a href="#" id="search"><i class="fa fa-search"></i></a>
                  </form>
               </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
               <ul class="breadcome-menu">
                  <li><a href="#">Home</a> <span class="bread-slash">/</span></li>
                  <li><span class="bread-blod">Add Professor</span></li>
               </ul>
            </div>
         </div>
      </div>
   </div>
</div>
<div class="product-status mg-b-15">
   <div class="container-fluid">
      <div class="row">
         <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="product-status-wrap drp-lst">
               <div class="add-product">
                  <h4>과제 게시판</h4>
                  <div class="taskBtn">
                     <input type="button" class="btn btn-primary waves-effect waves-light"
                           value="과제 목록" onclick="location.href='/task/taskList'">
                     <input type="button" id="taskInsertBtn" value="과제 등록" class="btn btn-primary waves-effect waves-light">
                  </div>
               </div>
               <div class="row">
                  <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                     <div class="breadcome-heading">

                     </div>
                  </div>
               </div>
               <div class="asset-inner">
                  <table>
                     <thead>
                        <tr>
                           <th>번호</th>
                           <th>상태</th>
                           <th>과제 명</th>
                           <th>과제 등록일 </th>
                           <th>과제 마감일</th>
                           <th>작성자</th>
                           <th>조회수</th>
                           <th>첨부 파일</th>
                        </tr>
                     <thead>
                     <tbody id="taskBody">
                     </tbody>
                  </table>
               </div>
               <div class="custom-pagination" id="divPaging">
               
               </div>
            </div>
         </div>
      </div>
   </div>
</div>